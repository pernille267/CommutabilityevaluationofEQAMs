% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utils_helpers.R
\name{recommendation_engine}
\alias{recommendation_engine}
\title{Expert System for Optimal Regression Model and Transformation Selection}
\usage{
recommendation_engine(data, zeta_critical = 4.24, parsimony_threshold = 0.2)
}
\arguments{
\item{data}{A \code{data.table} object containing the raw comparison data. Must include the following columns:
\itemize{
\item \code{comparison}: Character/Factor identifier for the IVD-MD pair.
\item \code{SampleID}: Identifier for specific samples.
\item \code{ReplicateID}: Identifier for replicates within samples.
\item \code{MP_A}: Measurement results for the first IVD-MD.
\item \code{MP_B}: Measurement results for the second IVD-MD.
}}

\item{zeta_critical}{Numeric. The upper threshold for the Zeta statistic (default: 4.24).
If an OLS model yields a Zeta score below this threshold, it is considered a "Success" and
the system will prioritize OLS over Smoothing Splines to prevent overfitting.}

\item{parsimony_threshold}{Numeric. If both (Smoothing Splines and OLS) zeta estimates
exceeds \code{zeta_critical}, the percentage reduction in in the zeta estimate produced
by Smoothing Splines is necessary to justify recommending this model.}
}
\value{
A named list where each element corresponds to a unique \code{comparison} from the input \code{data}.
Each element contains:
\itemize{
\item \code{comparison}: The comparison ID.
\item \code{model_type}: The selected model class ("OLS" or "SmoothingSpline").
\item \code{best_transformation}: The internal code for the optimal transformation (e.g., "log#e", "identity").
\item \code{reason}: A descriptive string explaining the logic behind the selection (e.g., "Consensus among all score metrics").
\item \code{zeta}: The Zeta statistic of the selected model/transformation.
\item \code{linear_success}: Logical. \code{TRUE} if OLS was sufficient, \code{FALSE} if fallback to Spline was required.
}
}
\description{
An automated decision-making engine that evaluates IVD-MD comparison data to recommend
the optimal statistical transformation (Identity, Log, or Box-Cox) and regression model
(Deming OLS or Smoothing Spline).

The function employs a "gatekeeper" logic combined with a sophisticated scoring algorithm
to balance model simplicity (OLS) against goodness-of-fit requirements.
}
\details{
\strong{The Decision Logic:}
The engine follows a hierarchical decision tree for each comparison in \code{data}:
\enumerate{
\item \strong{Transformation Evaluation:} It applies Identity, Log (natural), and Box-Cox (lambda=0.5) transformations to the data.
\item \strong{Linear Model Check (Gatekeeper):} It calculates the Zeta statistic using Ordinary Least Squares (OLS) for all transformations.
\item \strong{Branching:}
\itemize{
\item \emph{Path A (Success):} If any OLS Zeta is \eqn{\le} \code{zeta_critical}, the system restricts its selection to OLS models.
\item \emph{Path B (Fallback):} If all OLS Zetas exceed the threshold, the system switches to Non-Weighted Smoothing Splines.
}
\item \strong{Scoring & Selection:} The surviving models are ranked using a composite scoring system:
\itemize{
\item \emph{Absolute Difference:} \eqn{| \zeta - 1 |}
\item \emph{Relative Difference:} Penalizes deviations from the benchmark.
\item \emph{Dynamic Score:} A custom continuous function \eqn{f(x, b, L)} that is convex between the cutoff \eqn{L} (0.6) and benchmark \eqn{b} (1), and decays rapidly (concave) for values > \eqn{b}.
}
}

\strong{Tie-Breaking:}
If metrics disagree, the \strong{Dynamic Score} is prioritized. If a transformation shows no meaningful
improvement over Identity (improvement score \eqn{\le 0}), the system reverts to the Identity transformation.
}
